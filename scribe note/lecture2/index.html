<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Lecture 2 Scribe Notes, CS 111, Winter 16</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="css/theme.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  </head>
  <body>
    <div class="container">
        <div class="jumbotron center-text">
            <h1>Lecture 2 Scribe Notes, CS 111, Winter 16</h1>
            <p>Katie Aspinwall and Elton Leong</p>
        </div>
        <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-8">
        <div class="page-header">
            <h2>Table of Contents</h2>
        </div>
        <div class="row zero-margins">
            <div class="col">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Section</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><a href="#philosophy">I. A bit more philosophy</a></td>
                        </tr>
                        <tr>
                            <td><a href="#hownotos">II. How not to do an OS</a></td>
                        </tr>
                        <tr>
                            <td><a href="#wordcount">III. Word counting program</a></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="page-header" id="philosophy">
            <h2>I. A bit more philosophy</h2>
        </div>
            <img src="images/moores.svg" alt="Graph displaying exponential growth"/>
        <div class="page-header" id="hownotos">
            <h2>II. How not to do an OS</h2>
        </div>
        <div class="page-header" id="wordcount">
            <h2>III. Word counting program</h2>
        </div>
        <p>Hypothetical situation: Eggert is writing a document. As a paranoid professor, he wants his application to be as simple as possible and doesn't want to use an OS to do the following task: count the number of words in an ASCII text file (bytes '\001' - '\177', 1 - 127)</p>
        <div class="row">
            <div class="col-md-3"></div>
            <div class="col-md-6">
            <table class="table">
                <thead><tr><th>Computer specs</th></tr></thead>
                <tbody>
                    <tr>
                        <td>Core i3-4160 (3 MiB cache, 3.6 GHz)</td>
                    </tr>
                    <tr>
                        <td>4 GiB dual channel DDR3 1600 MHz SDRAM</td>
                    </tr>
                    <tr>
                        <td>1 TB hard drive, SATA, 7200rpm</td>
                    </tr>
                    <tr>
                        <td>Intel HD4400 graphics</td>
                    </tr>
                </tbody>
            </table>
            </div>
            <div class="col-md-3"></div>
        </div>
        <p>The controller communicates through the buses via their registers, listed below:</p>
<pre class="code">
0x1F0 ->        read data
0x1F2 ->        sector count
0x1F3  \        low order byte for the sector number
0x1F4   \                 
         |      sector number
0x1F5   / 
0x1F6  /        high order byte for the sector number
0x1F7 ->        status and command register, contains state information for disk controller
</pre>
<p>Reading 0x01000000 (0xC0) from the status and command register indicates that the disk is ready to receive a command.</p>
</pre>
<pre class="code prettyprint">
static inline inb(int a) {
    asm("____");
    â€¦
}
</pre>
<p>int and char are 4 bytes.</p>
<pre class="code prettyprint">
void read_ide_sector(int sector_num, char* memory_addr) {
</pre>
<p>Waitsuntil the disk's controller specifies that the disk is ready:</p>
<pre class="code prettyprint">
    while ((inb(0x1F7) & 0xC0) != 0x40)
        continue;
</pre>
<p>Write 1 to the sector count register, as we only want to read 1 byte:</p>
<pre class="code prettyprint">
    outb(0x1F2, 1);
</pre>
<p>outb writes only one byte, so we have to write each byte of the 4 byte integer, one at a time:</p>
<pre class="code prettyprint">
    outb(0x1F3, sector_num);
    outb(0x1F4, sector_num >> 8);
    outb(0x1F5, sector_num >> 16);
    outb(0x1F6, sector_num >> 24);
</pre>
<p>Issue the write command to the status and command register:</p>
<pre class="code prettyprint">
    outb(0x1F7, 0x20);
</pre>
<p>Wait for the disk to be ready again:</p>
<pre class="code prettyprint">
    while ((inb(0x1F7) & 0xC0) != 0x40)
        continue;
</pre>
<p>Read 128 longs (128 * 4 = 512 bits) from the controller's read data register (0x1F0):</p>
<pre class="code prettyprint">
    insl(0x1F0, memory_addr, 128);
}
</pre>
    </div>
    <div class="col-md-2"></div>
    </div>
    </div>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>
